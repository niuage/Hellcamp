<script type="text/javascript" charset="utf-8">
  $(function() {

    var update_page = function(data, room_name) {
      if (!data || !data.body || !data.user) return;
      var room = $("#" + room_name);
      if (room.length == 1) {
        room.post_message(data)
      } else {
        $("#tab_" + room_name).add_notification();
      }
    }

    var jug = new Juggernaut;
<% @rooms.each do |room| %>
      jug.subscribe("<%= room.id %>", function(data){
        update_page(data, "<%= room.name.downcase.gsub(" ", "_") %>")
      });
<% end %>
  })
</script>